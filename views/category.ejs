<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Admin | Category Management</title>
    <link rel="stylesheet" href="/css/dashboard.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css"
      rel="stylesheet"
    />

    <style>
      body {
        margin: 0;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f5f7fa;
        color: #333;
      }

      .main-content {
        padding: 2rem;
        flex-grow: 1;
        background-color: #f9fbfd;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      .content-wrapper {
        flex: 1;
      }

      h2 {
        font-size: 1.8rem;
        font-weight: 600;
        margin-bottom: 1.5rem;
      }

      .card {
        width: 100%;
        position: relative;
        left: 31vh;
        background-color: #ffffff;
        border-radius: 12px;
        padding: 2rem;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      }

      .card:hover {
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
      }

      .card-title {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 1.5rem;
        color: #333;
        border-bottom: 1px solid #eee;
        padding-bottom: 0.5rem;
      }

      form input[type='text'] {
        width: 100%;
        padding: 0.75rem 1rem;
        font-size: 1rem;
        border: 1px solid #ccc;
        border-radius: 8px;
        margin-bottom: 1rem;
      }

      button.primary {
        padding: 0.6rem 1.4rem;
        background-color: black;
        color: white;
        border: none;
        border-radius: 6px;
        font-weight: 500;
        cursor: pointer;
      }

      button.primary:hover {
        background-color: #333;
      }

      button.danger {
        background-color: #e74c3c;
        color: white;
        border: none;
        padding: 0.45rem 0.9rem;
        border-radius: 6px;
        cursor: pointer;
      }

      .category-list li {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem;
        border: 1px solid #eee;
        border-radius: 8px;
        margin-bottom: 0.75rem;
        background-color: #fff;
      }

      .empty {
        text-align: center;
        padding: 1rem;
        color: #888;
      }

      footer.footer {
        margin-top: auto;
        padding: 1rem 0;
        text-align: center;
        color: #888;
        font-size: 0.9rem;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      th,
      td {
        padding: 0.75rem;
        text-align: left;
        border: 1px solid black;
      }

      thead {
        background-color: #1e1e2f;
        color: #fff;
      }
    </style>
  </head>
  <body>
    <%- include('partials/adminheader') %>
    <div class="d-flex"><%- include('partials/sidebar') %></div>

    <div class="content-wrapper">
      <div class="card">
        <div class="card-title">Category Management</div>

        <div class="form-section">
          <h3>Manage Category</h3>
          <form
          action="/admin/categories/add"
          method="POST"
          id="category-form"
          enctype="application/x-www-form-urlencoded"
        >
          <input
            type="text"
            name="name"
            id="category-name"
            placeholder="Enter category name"
            required
          />
          <input type="hidden" name="_method" id="method-field" value="POST" />
          <button type="submit" class="primary" id="submit-btn">Add Category</button>
          <button type="button" onclick="resetForm()" style="display: none" id="cancel-btn">Cancel</button>
        </form>
        
        </div>

        <div class="list-section">
          <h4>Categories List</h4>
          <% if (categories && categories.length > 0) { %>
          <table>
            <thead>
              <tr>
                <th>Sr.No</th>
                <th>Category Name</th>
                <th>Actions</th>
              </tr>

            </thead>
            <tbody>
              <% categories.forEach((category, index) => { %>
              <tr>
                <td><%= index + 1 %></td>
                <td><%= category.name %></td>
                <td>
                  <button
                    class="primary"
                    onclick="editCategory('<%= category._id %>', '<%= category.name %>')"
                  >
                    Edit
                  </button>
                  <form
                    action="/admin/categories/delete/<%= category._id %>"
                    method="POST"
                    style="display: inline"
                    onsubmit="return confirm('Delete this category?');"
                  >
                    <button type="submit" class="danger">Delete</button>
                  </form>
                </td>
              </tr>
              <% }) %>
            </tbody>
          </table>
          <% } else { %>
          <p class="empty">No categories found.</p>
          <% } %>
        </div>
      </div>
    </div>

    <footer class="footer">
      &copy; 2025 Stock Manager. All rights reserved.
    </footer>

    <!-- jQuery + Toastr -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

    <!-- Toastr Notification Flash -->
    <script>
      // if (success && success.length > 0) {
      //   toastr.options = {
      //     closeButton: true,
      //     progressBar: true,
      //     positionClass: 'toast-top-right',
      //     timeOut: 3000,
      //   };
      //   toastr.success(' %>');
      // }

      // if (error && error.length > 0) {
      //   toastr.options = {
      //     closeButton: true,
      //     progressBar: true,
      //     positionClass: 'toast-top-right',
      //     timeOut: 3000,
      //   };
      //   toastr.error();
      // }
    </script>
<script>
  document.getElementById('category-form').addEventListener('submit', async function (e) {
    e.preventDefault();
  
    const form = e.target;
    const name = form.name.value.trim();
    const action = form.action;
    const method = form.querySelector('#method-field').value;
  
    if (!name) {
      toastr.error('Category name is required');
      return;
    }
  
    try {
      const response = await fetch(action, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded'
        },
        body: new URLSearchParams({ name })
      });
  
      if (response.redirected) {
        window.location.href = response.url;
      } else {
        const data = await response.json();
        if (response.ok) {
          toastr.success('Success');
          window.location.reload();
        } else {
          toastr.error(data.msg || 'Something went wrong');
        }
      }
    } catch (error) {
      console.error('Fetch error:', error);
      toastr.error('An error occurred');
    }
  });
  


function editCategory(id, name) {
  const form = document.getElementById('category-form');
  const input = document.getElementById('category-name');
  const methodField = document.getElementById('method-field');
  const submitBtn = document.getElementById('submit-btn');
  const cancelBtn = document.getElementById('cancel-btn');

  input.value = name;
  form.action = `/admin/categories/update/${id}`;
  methodField.value = 'PUT';
  submitBtn.textContent = 'Update Category';
  cancelBtn.style.display = 'inline-block';
  window.scrollTo({ top: form.offsetTop, behavior: 'smooth' });
}

function resetForm() {
  const form = document.getElementById('category-form');
  const input = document.getElementById('category-name');
  const methodField = document.getElementById('method-field');
  const submitBtn = document.getElementById('submit-btn');
  const cancelBtn = document.getElementById('cancel-btn');

  input.value = '';
  form.action = '/admin/categories/add';
  methodField.value = 'POST';
  submitBtn.textContent = 'Add Category';
  cancelBtn.style.display = 'none';
}

    </script>
    <%- include('partials/footer') %>
  </body>
</html>
